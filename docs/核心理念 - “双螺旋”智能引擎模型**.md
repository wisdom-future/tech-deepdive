
---

### **å›¾1ï¼šæ ¸å¿ƒç†å¿µ - â€œåŒèºæ—‹â€æ™ºèƒ½å¼•æ“æ¨¡å‹**

è¿™å¼ å›¾å°†â€œæ¢ç´¢â€ä¸â€œåˆ†æâ€ä¸¤ä¸ªæµç¨‹æ¯”ä½œDNAçš„åŒèºæ—‹ç»“æ„ï¼Œå®ƒä»¬ç›¸äº’ç¼ ç»•ï¼Œå…±åŒæ„æˆäº†ä»¥â€œå®ä½“â€ä¸ºæ ¸å¿ƒçš„æ™ºèƒ½ç³»ç»Ÿã€‚è¿™ç§ç»“æ„æ—¢ç¾è§‚ï¼Œåˆèƒ½å½¢è±¡åœ°è¡¨è¾¾ä¸¤ä¸ªæµç¨‹çš„å¯¹ç«‹ç»Ÿä¸€å’ŒååŒè¿›åŒ–ã€‚

```mermaid
graph TD
    subgraph " "
        direction TB
        subgraph Exploration [æ¢ç´¢æµç¨‹: ä»å®è§‚åˆ°å¾®è§‚]
            direction TB
            A["<div style='font-size:24px; color:#3b82f6;'>ğŸŒŒ</div><div style='font-weight:bold;'>ä½“ (Ecosystem)</div><div style='font-size:12px; color:#9ca3af;'>å…¨å±€è§†å›¾ / å¸‚åœºé›·è¾¾</div>"]
            A --> B["<div style='font-size:24px; color:#3b82f6;'>ğŸ—ºï¸</div><div style='font-weight:bold;'>é¢ (Area)</div><div style='font-size:12px; color:#9ca3af;'>ç‰¹å®šé¢†åŸŸ / ä¸»é¢˜ä¿¡æ¯æµ</div>"]
            B --> C["<div style='font-size:24px; color:#3b82f6;'>ğŸ•¸ï¸</div><div style='font-weight:bold;'>çº¿ (Connection)</div><div style='font-size:12px; color:#9ca3af;'>å®ä½“é—´å…³ç³»ç½‘ç»œ</div>"]
            C --> D["<div style='font-size:24px; color:#3b82f6;'>ğŸ“</div><div style='font-weight:bold;'>ç‚¹ (Entity)</div><div style='font-size:12px; color:#9ca3af;'>èšç„¦çš„å•ä¸ªå®ä½“</div>"]
        end

        subgraph Analysis [åˆ†ææµç¨‹: ä»å¾®è§‚åˆ°å®è§‚]
            direction TB
            H["<div style='font-size:24px; color:#10b981;'>ğŸŒ</div><div style='font-weight:bold;'>ä½“ (Knowledge Graph)</div><div style='font-size:12px; color:#9ca3af;'>å®è§‚çŸ¥è¯†å›¾è°± / è¶‹åŠ¿æ´å¯Ÿ</div>"]
            G["<div style='font-size:24px; color:#10b981;'>ğŸ§©</div><div style='font-weight:bold;'>é¢ (Profile)</div><div style='font-size:12px; color:#9ca3af;'>å®ä½“ç”»åƒ / é¢†åŸŸèšåˆ</div>"] --> H
            F["<div style='font-size:24px; color:#10b981;'>ğŸ”—</div><div style='font-weight:bold;'>çº¿ (Relationship)</div><div style='font-size:12px; color:#9ca3af;'>AIå…³ç³»æŠ½å– / è¯æ®é“¾æ„å»º</div>"] --> G
            E["<div style='font-size:24px; color:#10b981;'>ğŸ¯</div><div style='font-weight:bold;'>ç‚¹ (Entity as Anchor)</div><div style='font-size:12px; color:#9ca3af;'>ä½œä¸ºåˆ†æèµ·ç‚¹çš„å®ä½“</div>"] --> F
        end

        D -.-> E
        
        linkStyle 0,1,2 stroke:#3b82f6,stroke-width:3px,color:#3b82f6
        linkStyle 3,4,5 stroke:#10b981,stroke-width:3px,color:#10b981
        linkStyle 6 stroke:#f59e0b,stroke-width:2px,color:#f59e0b,stroke-dasharray: 5 5
        
        classDef default fill:#1f2937,stroke:#4b5563,stroke-width:2px,color:#e5e7eb,rx:10,ry:10,padding:15px;
        classDef entityNode fill:#4b5563,stroke:#f59e0b,stroke-width:3px,color:white;
        class D,E entityNode;
    end

    Title["<div style='font-size:22px; font-weight:bold; color:white;'>Deepdive Engine æ ¸å¿ƒç†å¿µï¼šåŒèºæ—‹æ™ºèƒ½æ¨¡å‹</div>"]
```

**å›¾è§£:**

*   **åŒèºæ—‹ç»“æ„:** å·¦ä¾§è“è‰²ä¸ºç”¨æˆ·çš„â€œæ¢ç´¢â€è·¯å¾„ï¼Œå³ä¾§ç»¿è‰²ä¸ºç³»ç»Ÿçš„â€œåˆ†æâ€è·¯å¾„ã€‚ä¸¤è€…å¹¶è¡Œä½†æ–¹å‘ç›¸åï¼Œå½¢è±¡åœ°å±•ç¤ºäº†Top-Downä¸Bottom-Upçš„å¯¹å¶å…³ç³»ã€‚
*   **è§†è§‰åŒ–èŠ‚ç‚¹:** æ¯ä¸ªèŠ‚ç‚¹éƒ½åŠ å…¥äº†å¤§å·Emojiå›¾æ ‡å’Œå¤šè¡Œæ–‡æœ¬ï¼Œä½¿å¾—æ¯ä¸ªé˜¶æ®µçš„å«ä¹‰æ›´åŠ ç›´è§‚æ˜“æ‡‚ã€‚
*   **æ ¸å¿ƒæ¢çº½:** ä¸­é—´çš„â€œç‚¹ (Entity)â€èŠ‚ç‚¹è¢«çªå‡ºæ˜¾ç¤ºï¼Œå¹¶é€šè¿‡è™šçº¿è¿æ¥ä¸¤ä¸ªæµç¨‹ï¼Œå¼ºè°ƒäº†å®ä½“ä½œä¸ºæ ¸å¿ƒæ¢çº½çš„å…³é”®ä½œç”¨ã€‚
*   **ç¾å­¦æå‡:** ä½¿ç”¨äº†æ›´æŸ”å’Œçš„èƒŒæ™¯è‰²ã€åœ†è§’å¡ç‰‡ã€ä»¥åŠæ›´å…·è®¾è®¡æ„Ÿçš„å­—ä½“å’Œé¢œè‰²æ­é…ã€‚

---

### **å›¾2ï¼šåç«¯æ¶æ„ - â€œæ´‹è‘±æ¨¡å‹â€**

è¿™å¼ å›¾å°†åç«¯åˆ†å±‚æ¶æ„æç»˜æˆä¸€ä¸ªæ´‹è‘±æ¨¡å‹ï¼Œä»å¤–åˆ°å†…åˆ†åˆ«æ˜¯ç”¨æˆ·äº¤äº’å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®å¤„ç†å±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œæ ¸å¿ƒæ˜¯æ•°æ®å­˜å‚¨ã€‚è¿™ç§æ¨¡å‹èƒ½éå¸¸ç›´è§‚åœ°è¡¨è¾¾å±‚çº§å…³ç³»å’Œä¾èµ–æ–¹å‘ã€‚

```mermaid
graph TD
    subgraph " "
        User[("ğŸ‘¨â€ğŸ’»<br>ç”¨æˆ·")]
        ExtAPI[("ğŸŒ<br>å¤–éƒ¨API")]

        subgraph Layer5 [L5: ç½‘å…³ä¸è®¤è¯]
            L5_Gateway["<div style='font-size:16px; font-weight:bold;'>API Gateway</div><div style='font-size:12px;'>ctrl.Code.js</div>"]
            L5_Auth["<div style='font-size:16px; font-weight:bold;'>Auth Service</div><div style='font-size:12px;'>layer05.AuthService.js</div>"]
        end

        subgraph Layer4 [L4: APIä¸šåŠ¡æœåŠ¡]
            L4_Services["<div style='font-size:16px; font-weight:bold;'>Dashboard, Analysis, Exploration...</div><div style='font-size:12px;'>layer04.*.js</div>"]
        end

        subgraph Layer3 [L3: æ•°æ®å¤„ç†ä¸é‡‡é›†]
            L3_Processing["<div style='font-size:16px; font-weight:bold;'>Processing & Drivers</div><div style='font-size:12px;'>layer03.*.js</div>"]
        end
        
        subgraph Layer2 [L2: æ•°æ®æŠ½è±¡]
           L2_DataService["<div style='font-size:16px; font-weight:bold;'>DataService</div><div style='font-size:12px;'>layer02.DataService.js</div>"]
        end

        subgraph Layer1 [L1: åŸºç¡€è®¾æ–½]
            L1_Connector["<div style='font-size:16px; font-weight:bold;'>DataConnector</div><div style='font-size:12px;'>layer01.DataConnector.js</div>"]
            L1_Firestore["<div style='font-size:16px; font-weight:bold;'>FirestoreService</div><div style='font-size:12px;'>layer01.FirestoreService.js</div>"]
        end

        subgraph Layer0 [L0: æ ¸å¿ƒå·¥å…·]
            L0_Utils["<div style='font-size:16px; font-weight:bold;'>Helpers & Prompts</div><div style='font-size:12px;'>layer00.*.gs</div>"]
        end
        
        FirestoreDB[("ğŸ—ƒï¸<br>Google Firestore")]
    end

    %% æµç¨‹è·¯å¾„
    User --> L5_Gateway --> L4_Services --> L2_DataService --> L1_Firestore --> FirestoreDB
    ExtAPI --> L1_Connector --> L3_Processing
    L3_Processing --> L2_DataService
    L3_Drivers --> L1_Connector
    L5_Gateway --> L5_Auth --> L2_DataService
    
    L3_Processing --> L0_Utils
    L1_Connector --> L0_Utils

    %% æ ·å¼å®šä¹‰
    classDef layerStyle fill-opacity:0.2,rx:20,ry:20,stroke-width:2px;
    class Layer5 layerStyle,fill:#e879f9,stroke:#d946ef
    class Layer4 layerStyle,fill:#a78bfa,stroke:#8b5cf6
    class Layer3 layerStyle,fill:#7dd3fc,stroke:#38bdf8
    class Layer2 layerStyle,fill:#6ee7b7,stroke:#34d399
    class Layer1 layerStyle,fill:#fde047,stroke:#facc15
    class Layer0 layerStyle,fill:#fdba74,stroke:#fb923c
    
    classDef nodeStyle fill:#111827,stroke:#9ca3af,color:white,rx:10,ry:10;
    class L5_Gateway,L5_Auth,L4_Services,L3_Processing,L2_DataService,L1_Connector,L1_Firestore,L0_Utils nodeStyle;

    style User,ExtAPI,FirestoreDB fill:#374151,stroke:#9ca3af,color:white,stroke-width:2px;
```

**å›¾è§£:**

*   **æ´‹è‘±æ¨¡å‹:** ä»å¤–å±‚ï¼ˆL5ï¼‰åˆ°å†…å±‚ï¼ˆL0ï¼‰ï¼Œæ¸…æ™°å±•ç¤ºäº†ä¾èµ–å…³ç³»ã€‚å¤–å±‚å¯ä»¥è°ƒç”¨å†…å±‚ï¼Œä½†å†…å±‚ä¸èƒ½è°ƒç”¨å¤–å±‚ã€‚
*   **é¢œè‰²åŒºåˆ†:** æ¯ä¸€å±‚éƒ½ç”¨ä¸åŒçš„é¢œè‰²é«˜äº®ï¼Œå¢å¼ºäº†è§†è§‰ä¸Šçš„åŒºåˆ†åº¦ã€‚
*   **æ ¸å¿ƒè·¯å¾„:** ç”¨ç®­å¤´æ¸…æ™°åœ°æ ‡ç¤ºå‡ºç”¨æˆ·è¯·æ±‚ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰å’Œåå°æ•°æ®å¤„ç†ï¼ˆä»å³åˆ°å·¦ï¼‰ä¸¤æ¡ä¸»è¦çš„æ•°æ®æµè·¯å¾„ã€‚
*   **å›¾æ ‡åŒ–:** å¤–éƒ¨ä¾èµ–å’Œæ•°æ®åº“éƒ½ä½¿ç”¨äº†å›¾æ ‡ï¼Œä½¿å…¶æ›´æ˜“äºè¯†åˆ«ã€‚

---

### **å›¾3ï¼šå‰ç«¯æ¶æ„ - â€œæŒ‡æŒ¥ä¸­å¿ƒâ€æ¨¡å‹**

è¿™å¼ å›¾å°†å‰ç«¯çš„æ ¸å¿ƒæ¨¡å— `main.js` å’Œ `state_api.js` æç»˜æˆä¸€ä¸ªæŒ‡æŒ¥ä¸­å¿ƒï¼Œå®ƒè´Ÿè´£è°ƒåº¦å„ä¸ªé¡µé¢æ¨¡å—ï¼Œå¹¶ä½œä¸ºä¸åç«¯é€šä¿¡çš„å”¯ä¸€é€šé“ã€‚

```mermaid
graph TD
    subgraph " "
        direction TB
        
        subgraph "æŒ‡æŒ¥ä¸­å¿ƒ (Core Control)"
            style CoreControl fill:none,stroke:none
            MainJS["<div style='font-size:24px;'>ğŸš€</div><div style='font-weight:bold;'>main.js.html</div><div style='font-size:12px;'>åº”ç”¨å…¥å£ & è·¯ç”±</div>"]
            StateAPI["<div style='font-size:24px;'>ğŸ“¡</div><div style='font-weight:bold;'>state_api.js.html</div><div style='font-size:12px;'>å…¨å±€çŠ¶æ€ & APIé€šä¿¡</div>"]
        end

        subgraph "åŠŸèƒ½æ¨¡å— (Page Modules)"
            style PageModules fill:none,stroke:none
            PageHome["<div style='font-size:24px;'>ğŸ“Š</div><div style='font-weight:bold;'>Dashboard</div><div style='font-size:12px;'>page_home.js</div>"]
            PageExplore["<div style='font-size:24px;'>ğŸŒŒ</div><div style='font-weight:bold;'>Exploration</div><div style='font-size:12px;'>page_exploration.js</div>"]
            PageAnalysis["<div style='font-size:24px;'>ğŸ’¡</div><div style='font-weight:bold;'>Analysis</div><div style='font-size:12px;'>page_analysis.js</div>"]
            PageOther["<div style='font-size:24px;'>âš™ï¸</div><div style='font-weight:bold;'>...</div>"]
        end
        
        subgraph "å¤–éƒ¨èµ„æº (External Resources)"
            style ExternalResources fill:none,stroke:none
            Backend[("â˜ï¸<br>åç«¯ç½‘å…³<br>callApi")]
            Libs[("ğŸ“š<br>ä¸‰æ–¹åº“<br>ECharts, Three.js")]
        end

        %% å…³ç³»
        MainJS -- "åˆå§‹åŒ– & åˆ‡æ¢" --> PageHome & PageExplore & PageAnalysis & PageOther
        PageHome & PageExplore & PageAnalysis & PageOther -- "è°ƒç”¨API" --> StateAPI
        StateAPI -- "å‘èµ·è¯·æ±‚" --> Backend
        StateAPI -- "å¤„ç†Mock" --> MockAPI["<div style='font-size:24px;'>ğŸ­</div><div style='font-weight:bold;'>mock_api.js.html</div><div style='font-size:12px;'>æœ¬åœ°æ¨¡æ‹Ÿ</div>"]
        
        PageHome & PageExplore & PageAnalysis & PageOther -. "ä½¿ç”¨" .-> Libs
        
        classDef core fill:#1e3a8a,stroke:#3b82f6,color:white;
        classDef page fill:#042f2e,stroke:#14b8a6,color:white;
        classDef external fill:#4a5563,stroke:#9ca3af,color:white;
        classDef mock fill:#581c87,stroke:#a855f7,color:white;
        class MainJS,StateAPI core;
        class PageHome,PageExplore,PageAnalysis,PageOther page;
        class Backend,Libs external;
        class MockAPI mock;
        
        classDef default rx:15,ry:15,padding:15px;
    end
    
    Title["<div style='font-size:22px; font-weight:bold; color:white;'>å‰ç«¯æ¶æ„ï¼šæŒ‡æŒ¥ä¸­å¿ƒæ¨¡å‹</div>"]
```

**å›¾è§£:**

*   **æŒ‡æŒ¥ä¸­å¿ƒ:** `main.js` å’Œ `state_api.js` è¢«å½¢è±¡åœ°ç½®äºä¸­å¿ƒä½ç½®ï¼Œä½“ç°äº†å®ƒä»¬åœ¨åº”ç”¨ä¸­çš„æ ¸å¿ƒè°ƒåº¦å’Œé€šä¿¡ä½œç”¨ã€‚
*   **æ¨¡å—åŒ–å¸ƒå±€:** å„ä¸ªé¡µé¢æ¨¡å—åƒå«æ˜Ÿä¸€æ ·å›´ç»•ç€æŒ‡æŒ¥ä¸­å¿ƒï¼Œå®ƒä»¬æ˜¯ç‹¬ç«‹çš„ï¼Œä½†éƒ½æ¥å—æŒ‡æŒ¥ä¸­å¿ƒçš„è°ƒåº¦ã€‚
*   **æ¸…æ™°çš„ä¾èµ–å…³ç³»:** å®çº¿ç®­å¤´è¡¨ç¤ºå¼ºä¾èµ–å’Œè°ƒç”¨å…³ç³»ï¼ˆå¦‚é¡µé¢æ¨¡å—å¿…é¡»é€šè¿‡`StateAPI`è°ƒç”¨åç«¯ï¼‰ï¼Œè™šçº¿ç®­å¤´è¡¨ç¤ºå¼±ä¾èµ–æˆ–ä½¿ç”¨å…³ç³»ï¼ˆå¦‚é¡µé¢æ¨¡å—ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è¿›è¡Œæ¸²æŸ“ï¼‰ã€‚
*   **æ¨¡æ‹Ÿ/çœŸå®åˆ†ç¦»:** `StateAPI` åˆ° `Backend` å’Œ `MockAPI` çš„ä¸¤æ¡è·¯å¾„æ¸…æ™°åœ°å±•ç¤ºäº†å‰ç«¯å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä¸‹åˆ‡æ¢æ•°æ®æºã€‚

å¸Œæœ›è¿™äº›ç»è¿‡ç¾åŒ–å’Œé‡æ„çš„å›¾ç¤ºèƒ½æ›´ç”ŸåŠ¨ã€æ›´ç›´è§‚åœ°ä¼ è¾¾æ‚¨é¡¹ç›®çš„æ ¸å¿ƒè®¾è®¡ç†å¿µå’Œç²¾å¦™æ¶æ„ã€‚
